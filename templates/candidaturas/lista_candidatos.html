{% extends 'candidaturas/base.html' %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2 class="mb-3">Verificação de Candidaturas</h2>

        <div class="mb-4">
            <div class="btn-group shadow-sm">
                <a href="?estado=PENDENTE"
                    class="btn btn-outline-primary {% if estado_atual == 'PENDENTE' %}active{% endif %}">
                    Pendentes
                </a>
                <a href="?estado=DOCS_APROVADOS"
                    class="btn btn-outline-success {% if estado_atual == 'DOCS_APROVADOS' %}active{% endif %}">
                    Aprovados (Doc)
                </a>
                <a href="?estado=DOCS_REJEITADOS"
                    class="btn btn-outline-danger {% if estado_atual == 'DOCS_REJEITADOS' %}active{% endif %}">
                    Rejeitados (Doc)
                </a>
                <a href="?estado=TODOS&vaga={{ vaga_atual }}&genero={{ genero_atual }}"
                    class="btn btn-outline-secondary {% if estado_atual == 'TODOS' %}active{% endif %}">
                    Todos
                </a>
            </div>
        </div>

        <div class="card mb-4 shadow-sm border-0 bg-light">
            <div class="card-body">
                <form method="get" class="row g-3 align-items-center">
                    <input type="hidden" name="estado" value="{{ estado_atual }}">

                    <div class="col-md-3">
                        <label class="form-label small text-muted">Vaga</label>
                        <select name="vaga" class="form-select border-0 shadow-sm">
                            <option value="">Todas as Vagas</option>
                            {% for v in vagas %}
                            {# CORREÇÃO: Espaços adicionados ao redor do == #}
                            <option value="{{ v.id }}" {% if v.id|stringformat:"s" == vaga_atual %}selected{% endif %}>
                                {{ v.titulo }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label small text-muted">Género</label>
                        <select name="genero" class="form-select border-0 shadow-sm">
                            <option value="">Todos</option>
                            {% for k, v in generos %}
                            {# CORREÇÃO: Espaços adicionados ao redor do == #}
                            <option value="{{ k }}" {% if k == genero_atual %}selected{% endif %}>{{ v }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    {% if provincias %}
                    <div class="col-md-3">
                        <label class="form-label small text-muted">Província</label>
                        <select name="provincia" class="form-select border-0 shadow-sm">
                            <option value="">Todas as Províncias</option>
                            {% for p in provincias %}
                            {# CORREÇÃO: Espaços adicionados ao redor do == #}
                            <option value="{{ p.id }}" {% if p.id|stringformat:"s" == provincia_atual %}selected{% endif %}>
                                {{ p.nome }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <div class="col-md-2 mt-4">
                        <button type="submit" class="btn btn-primary w-100 shadow-sm">
                            <i class="bi bi-filter me-1"></i>Filtrar
                        </button>
                    </div>

                    <div class="col-md-2 mt-4">
                        <a href="?estado={{ estado_atual }}" class="btn btn-outline-secondary w-100">
                            Limpar
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <div class="card shadow">
            <div class="card-body">
                {% if candidatos %}
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Vaga</th>
                            <th>BI</th>
                            <th>Data Submissão</th>
                            <th>Estado</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for c in candidatos %}
                        <tr>
                            <td>{{ c.nome_completo }}</td>
                            <td>{{ c.get_funcao_display }}</td>
                            <td>{{ c.numero_bi }}</td>
                            <td>{{ c.data_criacao|date:"d/m/Y H:i" }}</td>
                            <td><span class="badge bg-warning">{{ c.get_estado_display }}</span></td>
                            <td>
                                {% if apenas_visualizacao %}
                                <a href="{% url 'candidaturas:detalhe_candidato' c.pk %}"
                                    class="btn btn-sm btn-outline-primary">Ver Detalhes</a>
                                {% else %}
                                <a href="{% url 'candidaturas:detalhe_candidato' c.pk %}"
                                    class="btn btn-sm btn-primary">Verificar</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted text-center py-4">Nenhuma candidatura encontrada com este filtro.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}