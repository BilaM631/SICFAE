{% extends 'candidaturas/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow border-0">
            <div class="card-header bg-white py-3">
                <i class="fs-4 me-2">üìù</i>
                <h4 class="d-inline mb-0 fw-bold">Registo Manual de Candidato</h4>
            </div>

            <div class="card-body p-4">
                <form method="post" id="form-manual">
                    {% csrf_token %}

                    <!-- DADOS DO CANDIDATO -->
                    <h5 class="text-primary mb-3 text-uppercase small fw-bold">1. Dados Pessoais & Vaga</h5>
                    <div class="row mb-4">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nome Completo <span class="text-danger">*</span></label>
                            {{ form.nome_completo }}
                            {{ form.nome_completo.errors }}
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">N√∫mero de BI <span class="text-danger">*</span></label>
                            {{ form.numero_bi }}
                            {{ form.numero_bi.errors }}
                        </div>
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Telefone <span class="text-danger">*</span></label>
                            {{ form.numero_telefone }}
                            {{ form.numero_telefone.errors }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label class="form-label">Vaga a Candidatar <span class="text-danger">*</span></label>
                            {{ form.vaga }}
                            {{ form.vaga.errors }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label class="form-label">Prov√≠ncia <span class="text-danger">*</span></label>
                            {{ form.provincia }}
                            {{ form.provincia.errors }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Distrito <span class="text-danger">*</span></label>
                            {{ form.distrito }}
                            {{ form.distrito.errors }}
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- CHECKLIST -->
                    <h5 class="text-primary mb-3 text-uppercase small fw-bold">2. Checklist de Valida√ß√£o Documental</h5>
                    <div class="bg-light p-3 rounded border">
                        <div class="alert alert-info py-2 small">
                            <i class="me-1">‚ÑπÔ∏è</i> Valide os documentos apresentados fisicamente pelo candidato.
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="fw-bold">Documentos Essenciais</h6>
                                <div class="form-check mb-2">
                                    {{ form.validacao_bi }}
                                    <label class="form-check-label ms-1" for="{{ form.validacao_bi.id_for_label }}">
                                        Bilhete de Identidade (V√°lido)
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    {{ form.validacao_cv }}
                                    <label class="form-check-label ms-1" for="{{ form.validacao_cv.id_for_label }}">
                                        Curriculum Vitae (CV)
                                    </label>
                                </div>
                                <div class="form-check mb-2">
                                    {{ form.validacao_certificado }}
                                    <label class="form-check-label ms-1"
                                        for="{{ form.validacao_certificado.id_for_label }}">
                                        Certificado de Habilita√ß√µes
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <h6 class="fw-bold">Documentos Adicionais</h6>
                                <div class="form-check mb-2">
                                    {{ form.validacao_nuit }}
                                    <label class="form-check-label ms-1"
                                        for="{{ form.validacao_nuit.id_for_label }}">NUIT</label>
                                </div>
                                <div class="form-check mb-2">
                                    {{ form.validacao_registo_criminal }}
                                    <label class="form-check-label ms-1"
                                        for="{{ form.validacao_registo_criminal.id_for_label }}">Registo
                                        Criminal</label>
                                </div>
                                <div class="form-check mb-2">
                                    {{ form.validacao_atestado_medico }}
                                    <label class="form-check-label ms-1"
                                        for="{{ form.validacao_atestado_medico.id_for_label }}">Atestado M√©dico</label>
                                </div>
                                <div class="form-check mb-2">
                                    {{ form.validacao_requerimento }}
                                    <label class="form-check-label ms-1"
                                        for="{{ form.validacao_requerimento.id_for_label }}">Requerimento
                                        Assinado</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end gap-2 mt-4">
                        <a href="{% url 'candidaturas:painel_controlo' %}"
                            class="btn btn-outline-secondary btn-lg">Cancelar</a>
                        <button type="submit" class="btn btn-success btn-lg px-5">
                            üíæ Registar e Validar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
    rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
    $(document).ready(function () {
        $('.select2').select2({
            theme: 'bootstrap-5',
            width: '100%'
        });

        // Cascading Dropdown Logic (Provincia -> Distrito)
        $('#id_provincia').change(function () {
            var url = "{% url 'candidaturas:ajax_carregar_distritos' %}";
            var provinciaId = $(this).val();

            $.ajax({
                url: url,
                data: {
                    'provincia': provinciaId
                },
                success: function (data) {
                    var $distrito = $('#id_distrito');
                    $distrito.html('<option value="">---------</option>');
                    $.each(data, function (key, value) {
                        $distrito.append('<option value="' + value.id + '">' + value.nome + '</option>');
                    });
                }
            });
        });
    });
</script>
{% endblock %}